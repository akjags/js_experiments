var jsPsychImageKeyboardResponse=function(t){"use strict";function e(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,(s=a.key,r=void 0,"symbol"==typeof(r=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var a=i.call(t,e||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(s,"string"))?r:String(r)),a)}var s,r}var i={name:"image-keyboard-response",parameters:{stimulus:{type:t.ParameterType.IMAGE,pretty_name:"Stimulus",default:void 0},stimulus_height:{type:t.ParameterType.INT,pretty_name:"Image height",default:null},stimulus_width:{type:t.ParameterType.INT,pretty_name:"Image width",default:null},maintain_aspect_ratio:{type:t.ParameterType.BOOL,pretty_name:"Maintain aspect ratio",default:!0},choices:{type:t.ParameterType.KEYS,pretty_name:"Choices",default:"ALL_KEYS"},prompt:{type:t.ParameterType.HTML_STRING,pretty_name:"Prompt",default:null},stimulus_duration:{type:t.ParameterType.INT,pretty_name:"Stimulus duration",default:null},trial_duration:{type:t.ParameterType.INT,pretty_name:"Trial duration",default:null},response_ends_trial:{type:t.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0},render_on_canvas:{type:t.ParameterType.BOOL,pretty_name:"Render on canvas",default:!0}}},a=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.jsPsych=e}var i,a,s;return i=t,a=[{key:"trial",value:function(t,e){var i,a,s=this;if(e.render_on_canvas){var r=!1;if(t.hasChildNodes())for(;t.firstChild;)t.removeChild(t.firstChild);var n=document.createElement("canvas");n.id="jspsych-image-keyboard-response-stimulus",n.style.margin="0",n.style.padding="0";var u=n.getContext("2d");(m=new Image).onload=function(){r||(l(),u.drawImage(m,0,0,a,i))},m.src=e.stimulus;var l=function(){null!==e.stimulus_height?(i=e.stimulus_height,null==e.stimulus_width&&e.maintain_aspect_ratio&&(a=m.naturalWidth*(e.stimulus_height/m.naturalHeight))):i=m.naturalHeight,null!==e.stimulus_width?(a=e.stimulus_width,null==e.stimulus_height&&e.maintain_aspect_ratio&&(i=m.naturalHeight*(e.stimulus_width/m.naturalWidth))):null!==e.stimulus_height&&e.maintain_aspect_ratio||(a=m.naturalWidth),n.height=i,n.width=a};l(),t.insertBefore(n,null),m.complete&&Number.isFinite(a)&&Number.isFinite(i)&&(u.drawImage(m,0,0,a,i),r=!0),null!==e.prompt&&t.insertAdjacentHTML("beforeend",e.prompt)}else{var o='<img src="'+e.stimulus+'" id="jspsych-image-keyboard-response-stimulus">';null!==e.prompt&&(o+=e.prompt),t.innerHTML=o;var m=t.querySelector("#jspsych-image-keyboard-response-stimulus");null!==e.stimulus_height?(i=e.stimulus_height,null==e.stimulus_width&&e.maintain_aspect_ratio&&(a=m.naturalWidth*(e.stimulus_height/m.naturalHeight))):i=m.naturalHeight,null!==e.stimulus_width?(a=e.stimulus_width,null==e.stimulus_height&&e.maintain_aspect_ratio&&(i=m.naturalHeight*(e.stimulus_width/m.naturalWidth))):null!==e.stimulus_height&&e.maintain_aspect_ratio||(a=m.naturalWidth),m.style.height=i.toString()+"px",m.style.width=a.toString()+"px"}var h={rt:null,key:null},p=function(){s.jsPsych.pluginAPI.clearAllTimeouts(),void 0!==y&&s.jsPsych.pluginAPI.cancelKeyboardResponse(y);var i={rt:h.rt,stimulus:e.stimulus,response:h.key};t.innerHTML="",s.jsPsych.finishTrial(i)};if("NO_KEYS"!=e.choices)var y=this.jsPsych.pluginAPI.getKeyboardResponse({callback_function:function(i){t.querySelector("#jspsych-image-keyboard-response-stimulus").className+=" responded",null==h.key&&(h=i),e.response_ends_trial&&p()},valid_responses:e.choices,rt_method:"performance",persist:!1,allow_held_key:!1});null!==e.stimulus_duration&&this.jsPsych.pluginAPI.setTimeout((function(){t.querySelector("#jspsych-image-keyboard-response-stimulus").style.visibility="hidden"}),e.stimulus_duration),null!==e.trial_duration?this.jsPsych.pluginAPI.setTimeout((function(){p()}),e.trial_duration):!1===e.response_ends_trial&&console.warn("The experiment may be deadlocked. Try setting a trial duration or set response_ends_trial to true.")}},{key:"simulate",value:function(t,e,i,a){"data-only"==e&&(a(),this.simulate_data_only(t,i)),"visual"==e&&this.simulate_visual(t,i,a)}},{key:"simulate_data_only",value:function(t,e){var i=this.create_simulation_data(t,e);this.jsPsych.finishTrial(i)}},{key:"simulate_visual",value:function(t,e,i){var a=this.create_simulation_data(t,e),s=this.jsPsych.getDisplayElement();this.trial(s,t),i(),null!==a.rt&&this.jsPsych.pluginAPI.pressKey(a.response,a.rt)}},{key:"create_simulation_data",value:function(t,e){var i={stimulus:t.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),response:this.jsPsych.pluginAPI.getValidKey(t.choices)},a=this.jsPsych.pluginAPI.mergeSimulationData(i,e);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(t,a),a}}],a&&e(i.prototype,a),s&&e(i,s),Object.defineProperty(i,"prototype",{writable:!1}),t}();return a.info=i,a}(jsPsychModule);
//# sourceMappingURL=https://unpkg.com/@jspsych/plugin-image-keyboard-response@1.1.3/dist/index.browser.min.js.map
